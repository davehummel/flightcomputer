; PlatformIO Project Configuration File
;
;   Build options: build flags, source filter
;   Upload options: custom upload port, speed and extra flags
;   Library options: dependencies, extra library storages
;   Advanced options: extra scripting
;
; Please visit documentation for the other options and examples
; https://docs.platformio.org/page/projectconf.html





[env:feather_m0_flight_computer]
platform = teensy
;atmelsam
board = teensy40
;adafruit_feather_m0


framework = arduino
monitor_speed = 921600


build_flags =
  ;-D M0_FEATHER
  ;-D TIME_32BIT
	-D USB_SERIAL_HID ;enables joystick input
	-D SPI_RADIO_FREQ=4000000
  -D BATTERY_SENS_PIN=20
  -D LED_PIN=0
  -D LED_R_PIN=0
	-D LED_G_PIN=-1
	-D LED_B_PIN=-1
  -D ANALOG_READ_RESOLUTION=12
	-D ANALOG_READ_AVERAGING=8

	-D BATTERY_VLT_FACTOR=758.5
  -D BATTER_AUTO_OFF_VLT=3.0
  -D RADIO_CS_PIN=10
  -D RADIO_DIO0_PIN=16
  -D RADIO_DIO1_PIN=17
  -D RADIO_RST_PIN=9
  -D RECEIVER_ID=2
  -D MOTOR_COUNT=4
  -D MOTOR_PINS_FROM_BACK_TL_TR_BL_BR={7,8,15,14}
  -D MOTOR_CONFIG_TL_CLOCKWISE=1
  -D MOTOR_PITCH_FACTOR=1
  -D MOTOR_ROLL_FACTOR=1
  -D MOTOR_YAW_FACTOR=1
  -D MOTOR_THROTTLE_FACTOR=1000
  -D MOTOR_PWM_FREQ=50
  -D MOTOR_CONFIG=0
  -D ESC_TRACE
  -D ESC_TRACE_EVERY=200

  -D RADIO_CARRIER_FREQ=915.0
  -D RADIO_LINK_BANDWIDTH=500
  -D RADIO_SPREADING_FACTOR=7
  -D RADIO_POWER=17
  -D RADIO_CODING_RATE=5
  -D RADIO_INTERVAL_MILLIS=5
  -D RADIO_TRANSMIT_TIMEOUT_MICROS=500000UL
  -D RADIO_AGRESSIVE_RECEIVE_SWITCH
  -D INPUT_INTERVAL_MILLIS=50
  -D MIN_MICRO_REST=3
  ; -D TIME_SCALAR=1.00833
   -D RADIO_TASK_TRACKING

	-D RECEIVER_HB_ABANDON_MICROS=30000000UL

  -D USFSMAX_TRACKING
  -D USFSMAX_TRACE_EVERY=105
  -D USFSMAX_WIRE_INSTANCE=Wire
  -D USFSMAX_INT_PIN=1
  -D USFSMAX_I2C_CLOCK=400000  ;400kHz
  -D USFSMAX_IMU_RATE=105  ;105Hz (see Gyro rate and IMU rate divisor)
  
;   -D SCHEDULING_EVENT_TRACKING
  -D M_V=47.8532f
  -D M_H=20.1258f
  -D MAG_DECLINIATION=15.2208f

  -D NAV_RATE=USFSMAX_IMU_RATE  ;(match IMU input)

  -D NAV_INPUT_THROTTLE_SCALE=1000 ;direct throttle mapping to 0-1000 esc
  -D NAV_INPUT_YAW_SCALE=255 ;these map to shifts in the orientation (0-0XFFFF)
  -D NAV_INPUT_PITCH_SCALE=255
  -D NAV_INPUT_ROLL_SCALE=255
  -D NAV_INPUT_YAW_DIRECT_THRESHOLD=200  ;level of raw input to switch from setting target yaw from current or prev target yaw
  -D NAV_INPUT_PITCH_DIRECT_THRESHOLD=200 
  -D NAV_INPUT_ROLL_DIRECT_THRESHOLD=200 


  -D NAV_TRACE
  -D NAV_TRACE_EVERY=200
  -D NAV_TRACE_YAW_PID
  -D NAV_TRACE_ROLL_PID
  -D NAV_TRACE_PITCH_PID


  -D PID_YAW_KP=0.05
  -D PID_YAW_KI=0.004
  -D PID_YAW_KD=0.02
  -D PID_YAW_MAXOUT=1000
  -D PID_YAW_INPERIOD=__UINT16_MAX__
  -D PID_YAW_MAXINTEGRAL=2000

  -D PID_ROLL_KP=0.08
  -D PID_ROLL_KI=0.01
  -D PID_ROLL_KD=0.01
  -D PID_ROLL_MAXOUT=1000
  -D PID_ROLL_INPERIOD=__UINT16_MAX__
  -D PID_ROLL_MAXINTEGRAL=2000

  -D PID_PITCH_KP=0.05
  -D PID_PITCH_KI=0.02
  -D PID_PITCH_KD=0.02
  -D PID_PITCH_MAXOUT=1000
  -D PID_PITCH_INPERIOD=__UINT16_MAX__
  -D PID_PITCH_MAXINTEGRAL=2000




lib_extra_dirs =
  C:/dev/fdos/FDOS_C_VM/lib

lib_deps =
  jgromes/RadioLib @ ^5.1.0
  jchristensen/Timezone @ ^1.2.4
  arduino-libraries/Servo @ ^1.1.8


